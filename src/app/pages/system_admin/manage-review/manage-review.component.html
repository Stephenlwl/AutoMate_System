<div class="container py-4">
  <h2>Manage Reviews</h2>
  
  <!-- Stats Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card text-white bg-primary">
        <div class="card-body">
          <h5 class="card-title">Total Reviews</h5>
          <h3 class="card-text">{{ reviews.length }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Reviews Table -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">Approved Reviews</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-bordered table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th>Car Owner</th>
              <th>Vehicle</th>
              <th>Service Center</th>
              <th>Services</th>
              <th>Rating</th>
              <th>Review</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let review of reviews">
              <td>
                <strong>{{ review['userName'] }}</strong>
                <br>
                <small class="text-muted">{{ review['userEmail'] }}</small>
              </td>
              <td>
                {{ review['vehicleInfo']?.make }} {{ review['vehicleInfo']?.model }}
                <br>
                <small class="text-muted">{{ review['vehicleInfo']?.plateNumber }}</small>
              </td>
              <td>{{ review['serviceCenterName'] }}</td>
              <td>
                <span *ngFor="let service of review['services']" class="badge bg-secondary me-1">
                  {{ service.serviceName }}
                </span>
              </td>
              <td>
                <div class="rating-stars">
                  <span *ngFor="let star of [1,2,3,4,5]" 
                        [class.text-warning]="star <= review['rating']"
                        class="fs-5">â˜…</span>
                </div>
                <small class="text-muted">({{ review['rating'] }}/5)</small>
              </td>
              <td>{{ review['comment'] }}</td>
              <td>
                {{ review['createdAt']?.toDate() | date:'mediumDate' }}
                <br>
                <small class="text-muted">{{ review['createdAt']?.toDate() | date:'shortTime' }}</small>
              </td>
              <td>
                <button class="btn btn-danger btn-sm" (click)="openRemoveModal(review)">
                  Remove
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="reviews.length === 0" class="text-center py-5">
    <i class="bi bi-chat-quote fs-1 text-muted"></i>
    <h4 class="text-muted mt-3">No Approved Reviews</h4>
    <p class="text-muted">There are no approved reviews to display.</p>
  </div>
</div>

<!-- Remove Review Modal -->
<div class="modal fade" id="removeReviewModal" tabindex="-1" aria-labelledby="removeReviewModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="removeReviewModalLabel">Remove Review</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div *ngIf="selectedReview" class="review-preview mb-3 p-3 border rounded">
          <h6>Review Details:</h6>
          <p><strong>User:</strong> {{ selectedReview['userName'] }}</p>
          <p><strong>Service Center:</strong> {{ selectedReview['serviceCenterName'] }}</p>
          <p><strong>Rating:</strong> {{ selectedReview['rating'] }}/5</p>
          <p><strong>Comment:</strong> "{{ selectedReview['comment'] }}"</p>
        </div>
        
        <form [formGroup]="removeForm">
          <div class="mb-3">
            <label for="reason" class="form-label">Reason for Removal *</label>
            <textarea 
              class="form-control" 
              id="reason" 
              rows="4" 
              formControlName="reason"
              placeholder="Please provide the reason for removing this review..."
              [class.is-invalid]="removeForm.get('reason')?.invalid && removeForm.get('reason')?.touched">
            </textarea>
            <div class="invalid-feedback" *ngIf="removeForm.get('reason')?.errors?.['required']">
              Please provide a reason for removal.
            </div>
            <div class="invalid-feedback" *ngIf="removeForm.get('reason')?.errors?.['minlength']">
              Reason must be at least 10 characters long.
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button 
          type="button" 
          class="btn btn-danger" 
          (click)="removeReview()"
          [disabled]="removeForm.invalid || isRemoving">
          <span *ngIf="isRemoving" class="spinner-border spinner-border-sm me-2"></span>
          {{ isRemoving ? 'Removing...' : 'Remove Review' }}
        </button>
      </div>
    </div>
  </div>
</div>