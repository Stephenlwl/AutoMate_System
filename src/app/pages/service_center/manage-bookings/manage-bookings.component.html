<h3>Bookings</h3>

  <div class="mb-3">
    <select class="form-select w-auto d-inline-block me-2" [(ngModel)]="statusFilter">
      <option value="">All</option>
      <option *ngFor="let s of statuses" [value]="s">{{ s }}</option>
    </select>
    <button class="btn btn-outline-primary btn-sm" (click)="load()">Refresh</button>
  </div>

  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Customer</th><th>Vehicle</th><th>Requested</th><th>Status</th><th>Assigned</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let b of bookings">
          <td>{{ b.customer?.name }}<br><small>{{ b.customer?.phone }}</small></td>
          <td>{{ b.vehicle?.plate }}<br><small>{{ b.vehicle?.make }} {{ b.vehicle?.model }}</small></td>
          <td>{{ b.preferredDate?.toDate() | date:'short' }}</td>
          <td><span class="badge bg-secondary">{{ b.status }}</span></td>
          <td>
            <small *ngIf="b.assigned?.technicianId">Tech: {{ techMap[b.assigned.technicianId] || b.assigned.technicianId }}</small><br>
            <small *ngIf="b.assigned?.bayId">Bay: {{ bayMap[b.assigned.bayId] || b.assigned.bayId }}</small><br>
            <small *ngIf="b.assigned?.start">Start: {{ b.assigned.start.toDate() | date:'short' }}</small>
          </td>
          <td>
            <button class="btn btn-sm btn-outline-success me-1" (click)="confirm(b)" [disabled]="b.status!=='pending'">Confirm</button>
            <button class="btn btn-sm btn-outline-danger me-1" (click)="decline(b)" [disabled]="b.status!=='pending'">Decline</button>
            <button class="btn btn-sm btn-primary" (click)="openAssign(b)" [disabled]="b.status==='declined'||b.status==='cancelled'">Assign</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Assign Modal (simple inline modal) -->
  <div class="modal fade" [class.show]="showAssign" [style.display]="showAssign?'block':'none'" style="background:rgba(0,0,0,.5)">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Assign Technician & Bay</h5>
          <button class="btn-close" (click)="closeAssign()"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label">Technician</label>
            <select class="form-select" [formControl]="assignForm.controls.technicianId">
              <option *ngFor="let t of technicians" [value]="t.id">{{ t.name }}</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label">Bay</label>
            <select class="form-select" [formControl]="assignForm.controls.bayId">
              <option *ngFor="let b of bays" [value]="b.id">{{ b.name }}</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label">Start</label>
            <input type="datetime-local" class="form-control" [formControl]="assignForm.controls.start">
          </div>
          <div class="mb-2">
            <label class="form-label">Notes</label>
            <textarea class="form-control" rows="2" [formControl]="assignForm.controls.notes"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeAssign()">Cancel</button>
          <button class="btn btn-primary" (click)="saveAssign()">Save</button>
        </div>
      </div>
    </div>
  </div>