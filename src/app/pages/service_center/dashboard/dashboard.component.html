<div class="container">
  <h3 class="mb-4" style="color:#1F2A44;">Service Center Dashboard</h3>

  <div *ngIf="loading" class="text-center py-5">
    <span class="spinner-border spinner-border-sm me-2"></span> Loading dashboard...
  </div>

  <ng-container *ngIf="!loading">

    <!-- Service Appointments -->
    <h4 class="mt-3 mb-2 text-muted">Service Appointments</h4>
    <div class="row g-3">
      <div *ngFor="let stat of serviceStats" class="col-md-2">
        <div class="card shadow-sm border-0 h-100 text-center p-3 hover-card">
          <i [class]="stat.icon + ' fs-1 mb-2'" style="color:#FF6B00;"></i>
          <h6 class="fw-semibold small">{{ stat.label }}</h6>
          <h3 class="fw-bold">{{ stat.value }}</h3>
        </div>
      </div>
    </div>

    <!-- Towing Requests -->
    <h4 class="mt-4 mb-2 text-muted">Towing Requests</h4>
    <div class="row g-3">
      <div *ngFor="let stat of towingStats" class="col-md-2">
        <div class="card shadow-sm border-0 h-100 text-center p-3 hover-card">
          <i [class]="stat.icon + ' fs-1 mb-2'" style="color:#28A745;"></i>
          <h6 class="fw-semibold small">{{ stat.label }}</h6>
          <h3 class="fw-bold">{{ stat.value }}</h3>
        </div>
      </div>
    </div>

    <!-- Today's Bookings -->
    <div class="card shadow-sm mt-4">
      <div class="card-header bg-light">
        <h6 class="card-title mb-0">
          <i class="bi bi-calendar-day me-2"></i>Today's Bookings
          <span class="badge bg-primary ms-2">{{ todayBookings.length }}</span>
        </h6>
      </div>
      <div class="card-body p-0">
        <div *ngIf="todayBookings.length === 0" class="p-4 text-center text-muted">
          <i class="bi bi-calendar-x display-6"></i>
          <p class="mt-2 mb-0">No bookings for today.</p>
        </div>
        <div *ngIf="todayBookings.length > 0" class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th width="80">Type</th>
                <th width="150">Customer</th>
                <th width="180">Vehicle</th>
                <th width="120">Scheduled Time</th>
                <th width="150">Assignment</th>
                <th width="100">Status</th>
                <th width="120">Details</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let booking of todayBookings" 
                  [class.table-warning]="booking.status === 'pending'"
                  [class.table-info]="booking.status === 'confirmed' || booking.status === 'accepted'"
                  [class.table-primary]="booking.status === 'assigned' || booking.status === 'dispatched'"
                  [class.table-orange]="booking.status === 'in_progress' || booking.status === 'ongoing'">
                <td>
                  <span class="badge" [ngClass]="{
                    'bg-primary': booking.type === 'service',
                    'bg-info': booking.type === 'towing'
                  }">
                    <i [class]="booking.type === 'service' ? 'bi bi-wrench me-1' : 'bi bi-truck me-1'"></i>
                    {{ booking.type | titlecase }}
                  </span>
                </td>
                <td>
                  <div class="fw-medium">{{ booking.customer?.name || 'N/A' }}</div>
                  <small class="text-muted">{{ booking.customer?.phone || 'No phone' }}</small>
                </td>
                <td>
                  <div class="fw-medium">{{ getVehicleDisplay(booking) }}</div>
                  <small *ngIf="booking.type === 'towing'" class="text-muted">
                    {{ booking.towingType || 'General Towing' }}
                  </small>
                </td>
                <td>
                  <div class="fw-medium">{{ getDisplayTime(booking) }}</div>
                  <small *ngIf="booking.type === 'service'" class="text-muted">
                    {{ booking.scheduledDate?.toDate() | date:'MMM d' }}
                  </small>
                </td>
                <td>
                  <div class="small">{{ getAssignmentInfo(booking) }}</div>
                  <small *ngIf="booking.type === 'towing' && booking.location" class="text-muted">
                    {{ booking.location.address }}
                  </small>
                </td>
                <td>
                  <span class="badge" [ngClass]="getStatusBadgeClass(booking.status)">
                    {{ booking.status | titlecase }}
                  </span>
                </td>
                <td>
                  <small *ngIf="booking.type === 'service'" class="text-muted">
                    <span *ngIf="booking.services?.length">
                      {{ booking.services.length }} service(s)
                    </span>
                    <span *ngIf="booking.packages?.length">
                      + {{ booking.packages.length }} package(s)
                    </span>
                  </small>
                  <small *ngIf="booking.type === 'towing'" class="text-muted">
                    {{ booking.towingType || 'General' }}
                  </small>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </ng-container>
</div>